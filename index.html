<!DOCTYPE HTML>
<!--
	Aerial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Beat in a Bot</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
                <link rel="apple-touch-icon" sizes="57x57" href="icons/apple-icon-57x57.png">
                <link rel="apple-touch-icon" sizes="60x60" href="icons/apple-icon-60x60.png">
                <link rel="apple-touch-icon" sizes="72x72" href="icons/apple-icon-72x72.png">
                <link rel="apple-touch-icon" sizes="76x76" href="icons/apple-icon-76x76.png">
                <link rel="apple-touch-icon" sizes="114x114" href="icons/apple-icon-114x114.png">
                <link rel="apple-touch-icon" sizes="120x120" href="icons/apple-icon-120x120.png">
                <link rel="apple-touch-icon" sizes="144x144" href="icons/apple-icon-144x144.png">
                <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-icon-152x152.png">
                <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-icon-180x180.png">
                <link rel="icon" type="image/png" sizes="192x192"  href="icons/android-icon-192x192.png">
                <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
                <link rel="icon" type="image/png" sizes="96x96" href="icons/favicon-96x96.png">
                <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
                <link rel="manifest" href="icons/manifest.json">
                <meta name="msapplication-TileColor" content="#ffffff">
                <meta name="msapplication-TileImage" content="icons/ms-icon-144x144.png">
                <meta name="theme-color" content="#ffffff">
                <script src="https://code.jquery.com/jquery-1.9.1.js"></script> 
	</head>
	<body class="loading">
		<div id="wrapper">
			<div id="bg"></div>
			<div id="overlay"></div>
			<div id="main">

				<!-- Header -->
					<header id="header">
						<img id="logo" src="assets/images/logo.png" alt="Smiley face">
                                                <div style='font-size: 1.5em'><b> Music on your personality.</b></div>
						
                                                     
                                                    <p style='font-size: 1.2em'> 1. By login with Facebook, we collect the pages you've liked</p>
                                                    <fb:login-button scope="public_profile,email,user_likes" onlogin="checkLoginState();"></fb:login-button>
                                                    <div style="padding-top: 0.5em; color:black;" id="status"></div>
                                                    <!--<button style='background: none;' onclick="logout()">logout da facebook</button>-->
                                                    <p style='font-size: 1.2em'> 2. Those are used to predict your personality profile<p>
                                                    <button disabled id="startbutton">Start!</button>
                                                    <br>                                    
                                                    <div id="result">
                                                        <p>Your personality is INTP. "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>  
                                                        
                                                        <figure id="musician">
                                                            <img id="mus_img" src="assets/images/logo.png" alt="Smiley face">
                                                            <figcaption style="font-size: 1em">Fig.1 - A view of the pulpit rock in Norway.</figcaption>
                                                        </figure>     
                                                    </div>
                                                    <div style="padding-top: 0.5em; color:black; font-size: 1.2em"><b id="computing"></b></div>
                                                    <div id="continue" style="display: none; padding-top: 0.5em;">Say "continue" to the bot to get your music recommendations!</div>
                                                    <div id="error"></div>
													
					</header>

				<!-- Footer -->
					<footer id="footer">
                                            <span class="copyright">&copy; Beat in a Bot. Click <a href=license.html>here</a> to check our privacy policy.</span>
					</footer>

			</div>
		</div>
		<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
		<script>
			window.onload = function() { document.body.className = ''; }
			window.ontouchmove = function() { return false; }
			window.onorientationchange = function() { document.body.scrollTop = 0; } 
                        
                            
    /*** Carica l'SDK in modo asincrono nella pagina HTML***/
    
    (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
    
    
    /***inizializza Facebook SDK e verifica lo stato del login***/
    
    window.fbAsyncInit = function() {
        
        FB.init({
          appId      : '297859887285839',
          cookie     : true,  // enable cookies to allow the server to access the session
          xfbml      : true,  // parse social plugins on this page
          version    : 'v2.10' // use graph api version 2.8
        });
       
        // Now that we've initialized the JavaScript SDK, we call 
        // FB.getLoginStatus().  This function gets the state of the
        // person visiting this page and can return one of three states to
        // the callback you provide.  They can be:
        //
        // 1. Logged into your app ('connected')
        // 2. Logged into Facebook, but not your app ('not_authorized')
        // 3. Not logged into Facebook and can't tell if they are logged into
        //    your app or not.
        //
        // These three cases are handled in the callback function.

        //lo stato verificato viene passato a statusChangeCallback
        FB.getLoginStatus(function(response) {
          statusChangeCallback(response);
        });
    };
    
    
    
    
    /*** Questa funzione viene invocata quandno si ricarica la pagina oppure se si preme il pulsante di login come conseguenza della chiamata
     *   all'handler del bottone checkLoginState()  ***/
    
    var resp = null;
    
    function statusChangeCallback(response) {
        
        var getUrlParameter = function getUrlParameter(sParam) {
                var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                    sURLVariables = sPageURL.split('&'),
                    sParameterName,
                    i;

                for (i = 0; i < sURLVariables.length; i++) {
                    sParameterName = sURLVariables[i].split('=');

                    if (sParameterName[0] === sParam) {
                        return sParameterName[1] === undefined ? true : sParameterName[1];
                    }
                }
            };

        
        if (response.status === 'connected') {
            
            var fb_access_token = response.authResponse.accessToken;
            var name;
            
            console.log('Welcome!  Fetching your information.... ');    
            FB.api('/me', function(response) {
                name = response.name;
                console.log('Successful login for: ' + response.name);
                document.getElementById('status').innerHTML =
                  'Thanks for logging in, ' + response.name + '!';
             });
             
             //disabilita il bottone associagli l'event listener su click
             var startbutton = document.getElementById("startbutton");
             startbutton.disabled = false;
             document.getElementById("startbutton").addEventListener("click",function(){
                 
                startbutton.disabled = true;
                document.getElementById("computing").innerHTML = "Processing...";
                
                var sessionId = getUrlParameter('sessionId');
                console.log(sessionId);
                
                const url = "https://cors-anywhere.herokuapp.com/http://datascience.ismb.it/beatinabot/hello?userid="+response.authResponse.userID+"&accessToken="+fb_access_token+"&name="+name+"&sessionId="+sessionId;
                
                 
                    $.ajax({
                        url: url,
                        type: 'GET',
                        success: function(response, textStatus, xhr)
                        {
                            
                            console.log(response);
                            console.log(textStatus);  
                            document.getElementById("computing").innerHTML = response;
                            
                            //qui conosco il Profilo di personalità Jungiana.
                            
                            
                            
                            document.getElementById("continue").style.display ="";
                            startbutton.disabled = false;
                            
                        },
                        error: function(XMLHttpRequest, textStatus, errorThrown)
                        {
                            document.getElementById("continue").style.display ="none";
                          
                            if (XMLHttpRequest.readyState == 4) {
                                // HTTP error (can be checked by XMLHttpRequest.status and XMLHttpRequest.statusText)
                                document.getElementById("computing").style.color = "red";
                                document.getElementById("computing").innerHTML = XMLHttpRequest.status+""+XMLHttpRequest.statusText;
                            }
                            else if (XMLHttpRequest.readyState == 0) {
                                // Network error (i.e. connection refused, access denied due to CORS, etc.)
                                document.getElementById("computing").style.color = "red";
                                document.getElementById("computing").innerHTML = "Network error, there was a problem contacting the server.";
                            }
                            else {
                                // something weird is happening
                                document.getElementById("computing").style.color = "red";
                                document.getElementById("computing").innerHTML = "Very strange error, something bad happened";
                            }
                            startbutton.disabled = false;
                        }
                });    
                 
             });
    
            
        } else {
          // The person is not logged into your app or we are unable to tell.
          document.getElementById('status').innerHTML = 'Please log ' +
            'into this app.';
        }
    }
    
    /*** Handler del bottone Log in. Controlla lo stato del login e chiama la funzione che gestisce cosa fare ***/
    
    function checkLoginState() {
        
        FB.getLoginStatus(function(response) {
          statusChangeCallback(response);
        });
        
    }
    
   function JungianTypeResult(mbti){

            switch(mbti) {
                    case "ISTJ":
                        
                        break;
                    case "ISFJ":

                        break;
                    case "INFJ":

                        break;
                    case "INTJ":

                        break;
                    case "ISTP":

                        break;
                    case "ISFP":

                        break;
                    case "INFP":

                        break;
                    case "INTP":

                        break;
                    case "ESTP":

                        break;
                    case "ESFP":

                        break;
                    case "ENFP":

                        break;
                    case "ENTP":

                        break;
                    case "ESTJ":

                        break;
                    case "ESFJ":

                        break;
                    case "ENFJ":

                        break;
                    case "ENTJ":

                        break;

                    default:
                        return "there was an error"

                    } 
        }
    
    
    
 function logout(){
     
            FB.logout(function(response) {
             // user is now logged out
             console.log("Logout effettuato");
             document.getElementById("status").innerHTML = "logout effettuato";
             document.getElementById("startbutton").disabled = true;

            });  
        }
    
    
    
    
         
                        		
                </script>
	</body>
</html>
